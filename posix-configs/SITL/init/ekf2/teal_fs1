uorb start
param load
dataman start

set VEHICLE_TYPE mc
set MIXER quad_x
set MIXER_AUX none
set PWM_OUT 1234

param set MAV_TYPE 2

# Configure Teal FS1 Parameters:
# battery
param set BAT_CAPACITY 2750
param set BAT_CRIT_THR 0.125
param set BAT_EMERGEN_THR 0.1
param set BAT_LOW_THR 0.15
param set BAT_N_CELLS 4
param set BAT_R_INTERNAL 0.00875
param set BAT_SOURCE 1
param set BAT_V_CHARGED 4.15
param set BAT_V_DIV 11.1625
param set BAT_V_EMPTY 3.6
param set BAT_V_OFFS_CURR -0.0045

# primary accel
#param set CAL_ACC_PRIME 1442826
param set CAL_ACC0_ID 1376264
param set CAL_ACC0_XOFF 0.01
param set CAL_ACC0_XSCALE 1.01
param set CAL_ACC0_YOFF -0.01
param set CAL_ACC0_YSCALE 1.01
param set CAL_ACC0_ZOFF 0.01
param set CAL_ACC0_ZSCALE 1.01
param set CAL_ACC1_ID 1310728
param set CAL_ACC1_XOFF 0.01
param set CAL_GYRO0_ID 2293768
param set CAL_GYRO0_XOFF 0.01
param set CAL_MAG0_ID 196616
param set CAL_MAG0_XOFF 0.01

# circuit breakers
param set CBRK_IO_SAFETY 22027
param set CBRK_USB_CHK 197848

# commander
param set COM_DISARM_LAND 1
param set COM_LOW_BAT_ACT 3
param set COM_OBL_ACT 2
param set COM_OBL_RC_ACT 0
param set COM_OF_LOSS_T 5
param set COM_RC_IN_MODE 1

# ekf2
param set EKF2_AID_MASK 1
param set EKF2_ANGERR_INIT 0.01
param set EKF2_GBIAS_INIT 0.01
param set EKF2_ACC_NOISE 0.35
param set EKF2_GPS_CHECK 511
param set EKF2_GYR_NOISE 0.025
param set EKF2_GPS_POS_X -0.045
param set EKF2_IMU_POS_X -0.075
param set EKF2_HGT_MODE 0
param set EKF2_MAG_TYPE 1

# gps
param set GPS_UBX_DYNMODEL 7

# geofence
param set GF_ACTION 1
param set GF_MAX_HOR_DIST 0

# land detector
param set LNDMC_THR_RANGE 0.2
param set LNDMC_XY_VEL_MAX 1.25
param set LNDMC_Z_VEL_MAX 0.5

# local position estimator
param set LPE_EPH_MAX 2.5
param set LPE_EPV_MAX 5.3
param set LPE_FUSION 145

# mav airframe type
param set MAV_TYPE 2

# mc_att_control
param set MC_BAT_SCALE_EN 1
param set MC_ACRO_P_MAX 540.0
param set MC_ACRO_R_MAX 540.0
param set MC_ACRO_Y_MAX 360.0
param set MC_BAT_SCALE_EN 0

param set MC_ROLL_P 6.0
param set MC_ROLL_TC 0.2
param set MC_ROLLRATE_P 0.055
param set MC_ROLLRATE_I 0.2
param set MC_ROLLRATE_D 0.0012
param set MC_ROLLRATE_MAX 240.0
param set MC_ROLLRATE_FF 0.0
param set MC_RR_INT_LIM 0.3

param set MC_PITCH_P 6.5
param set MC_PITCH_TC 0.2
param set MC_PITCHRATE_P 0.06
param set MC_PITCHRATE_I 0.2
param set MC_PITCHRATE_D 0.0012
param set MC_PITCHRATE_MAX 240.0
param set MC_PITCHRATE_FF 0.0
param set MC_PR_INT_LIM 0.3

param set MC_YAW_P 2.0
param set MC_YAW_FF 0.6
param set MC_YAWRATE_P 0.08
param set MC_YAWRATE_I 0.8
param set MC_YAWRATE_D 0.0
param set MC_YAWRAUTO_MAX 45.0
param set MC_YAWRATE_FF 0.0
param set MC_YAWRATE_MAX 240.0

# mc_pos_control
param set MPC_ACC_DOWN_MAX 5.0
param set MPC_ACC_HOR 6.5
param set MPC_ACC_HOR_MAX 10.0
param set MPC_ACC_UP_MAX 2.5
param set MPC_DEC_HOR_SLOW 5.0 
param set MPC_HOLD_DZ 0.01
param set MPC_HOLD_MAX_XY 0.8
param set MPC_HOLD_MAX_Z 0.6
param set MPC_JERK_MAX 7.5
param set MPC_JERK_MIN 1.0
param set MPC_LAND_ALT1 7.5
param set MPC_LAND_ALT2 3.0
param set MPC_LAND_SPEED 0.8
param set MPC_MANTHR_MAX 0.85
param set MPC_MANTHR_MIN 0.15
param set MPC_MAN_TILT_MAX 45.0
param set MPC_MAN_Y_MAX 240.0
param set MPC_THR_MAX 0.85
param set MPC_THR_MIN 0.15
param set MPC_TILTMAX_AIR 45.0
param set MPC_TILTMAX_LND 15.0
param set MPC_TKO_RAMP_T 1.0
param set MPC_TKO_SPEED 0.75
param set MPC_VEL_MANUAL 15.0
param set MPC_XY_CRUISE 10.0
param set MPC_XY_P 1.5
param set MPC_XY_VEL_P 0.06
param set MPC_XY_VEL_I 0.01
param set MPC_XY_VEL_D 0.005
param set MPC_XY_VEL_MAX 15
param set MPC_Z_P 0.8
param set MPC_Z_VEL_P 0.2
param set MPC_Z_VEL_I 0.02
param set MPC_Z_VEL_D 0.0
param set MPC_Z_VEL_MAX_DN 4.0
param set MPC_Z_VEL_MAX_UP 6.0

# mission
param set MIS_TAKEOFF_ALT 2.5

# navigator
param set NAV_ACC_RAD 2.5
param set NAV_DLL_ACT 1
param set NAV_RCL_ACT 1
param set NAV_RCL_LT 120

# pwm control
param set PWM_DISARMED 1000
param set PWM_MAX 1750
param set PWM_MIN 1075
param set PWM_RATE 400

# rtl
param set RTL_DESCEND_ALT 5
param set RTL_LAND_DELAY 5
param set RTL_MIN_DIST 5
param set RTL_RETURN_ALT 5

# sd logging
param set SDLOG_DIRS_MAX 10
param set SDLOG_PROFILE 127
param set SDLOG_RATE 125

# system
param set SYS_AUTOSTART 4100
param set SYS_COMPANION 1921600
param set SYS_LOGGER 1
param set SYS_MC_EST_GROUP 2

replay tryapplyparams
simulator start -s
tone_alarm start
gyrosim start
accelsim start
barosim start
adcsim start
gpssim start
pwm_out_sim mode_pwm
sensors start
commander start
land_detector start multicopter
navigator start
ekf2 start
mc_pos_control start
mc_att_control start
mixer load /dev/pwm_output0 ROMFS/px4fmu_common/mixers/quad_w.main.mix
mavlink start -x -u 14556 -r 4000000
mavlink start -x -u 14557 -r 4000000 -m onboard -o 14540
mavlink stream -r 50 -s POSITION_TARGET_LOCAL_NED -u 14556
mavlink stream -r 50 -s LOCAL_POSITION_NED -u 14556
mavlink stream -r 50 -s GLOBAL_POSITION_INT -u 14556
mavlink stream -r 50 -s ATTITUDE -u 14556
mavlink stream -r 50 -s ATTITUDE_QUATERNION -u 14556
mavlink stream -r 50 -s ATTITUDE_TARGET -u 14556
mavlink stream -r 50 -s SERVO_OUTPUT_RAW_0 -u 14556
mavlink stream -r 20 -s RC_CHANNELS -u 14556
mavlink stream -r 250 -s HIGHRES_IMU -u 14556
mavlink stream -r 10 -s OPTICAL_FLOW_RAD -u 14556
logger start -e -t
mavlink boot_complete
replay trystart
