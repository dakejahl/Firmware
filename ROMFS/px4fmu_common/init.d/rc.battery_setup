#!nsh
#
# Startup script for writing battery parameters for BQ40Z50 SMBus smart battery
#
usleep 100000

batt_smbus -X suspend

usleep 100000

batt_smbus -X unseal

usleep 50000

# "Settings","Configuration","Power Config"
batt_smbus -X write_flash 18571 2 1 0
echo "Wrote smart battery param - Power Config"
# "Settings","Configuration","DA Configuration"
batt_smbus -X write_flash 19069 2 27 0
echo "Wrote smart battery param - DA Configuration"
# "Settings","Configuration","IT Gauging Configuration"
batt_smbus -X write_flash 18711 2 222 210
echo "Wrote smart battery param - IT Gauging Configuration"

# "Settings","AFE","AFE Protection Control"
batt_smbus -X write_flash 19072 1 115
echo "Wrote smart battery param - AFE Protection Control"
# "Settings","Manufacturing","Mfg Status init"
batt_smbus -X write_flash 17920 2 56 2
echo "Wrote smart battery param - Mfg Status init"


# "Power","Sleep","Bus Timeout"
batt_smbus -X write_flash 18597 1 255
echo "Wrote smart battery param - Bus Timeout"
# "Power","Ship","Auto Ship Time"
batt_smbus -X write_flash 18607 2 255 255
echo "Wrote smart battery param - Auto Ship Time"


# "SBS Configuration","Data","Specification Information"
batt_smbus -X write_flash 18642 2 52 0
echo "Wrote smart battery param - Specification Information"


# "Protections","CUV","Threshold"
batt_smbus -X write_flash 18748 2 84 11
echo "Wrote smart battery param - CUV Threshold"

# "Protections","COV","Threshold Low Temp"
batt_smbus -X write_flash 18758 2 -77 16
echo "Wrote smart battery param - COV Threshold Low Temp"
# "Protections","COV","Threshold Standard Temp Low"
batt_smbus -X write_flash 18760 2 -77 16
echo "Wrote smart battery param - COV Threshold Standard Temp Low"
# "Protections","COV","Threshold Standard Temp High"
batt_smbus -X write_flash 18762 2 -77 16
echo "Wrote smart battery param - COV Threshold Standard Temp High"
# "Protections","COV","Threshold High Temp"
batt_smbus -X write_flash 18764 2 -77 16
echo "Wrote smart battery param - COV Threshold High Temp"
# "Protections","COV","Threshold Rec Temp"
batt_smbus -X write_flash 18766 2 -77 16
echo "Wrote smart battery param - COV Threshold Rec Temp"

# "Protections","AOLD","Latch Limit"
batt_smbus -X write_flash 18803 1 100
echo "Wrote smart battery param - Latch Limit"
# "Protections","AOLD","Counter Dec Delay"
batt_smbus -X write_flash 18804 1 1
echo "Wrote smart battery param - Counter Dec Delay"
# "Protections","AOLD","Recovery"
batt_smbus -X write_flash 18805 1 15
echo "Wrote smart battery param - AOLD Recovery"
# "Protections","AOLD","Reset"
batt_smbus -X write_flash 18806 1 15
echo "Wrote smart battery param - AOLD Reset"
# "Protections","AOLD","Threshold"
batt_smbus -X write_flash 19073 1 207
echo "Wrote smart battery param - AOLD Threshold"

# "Protections","ASCD","Latch Limit"
batt_smbus -X write_flash 18811 1 10
echo "Wrote smart battery param - ASCD Latch Limit"
# "Protections","ASCD","Counter Dec Delay"
batt_smbus -X write_flash 18812 1 1
echo "Wrote smart battery param - ASCD Counter Dec Delay"
# "Protections","ASCD","Recovery"
batt_smbus -X write_flash 18813 1 15
echo "Wrote smart battery param - ASCD Recovery"
# "Protections","ASCD","Reset"
batt_smbus -X write_flash 18814 1 15
echo "Wrote smart battery param - ASCD Reset"

# "Protections","ASCD","Threshold 1"
batt_smbus -X write_flash 19075 1 52
echo "Wrote smart battery param - ASCD Threshold 1"
# "Protections","ASCD","Threshold 2"
batt_smbus -X write_flash 19076 1 21
echo "Wrote smart battery param - ASCD Threshold 2"

# "Protections","OTD","Threshold"
batt_smbus -X write_flash 18820 2 48 14
echo "Wrote smart battery param - OTD Threshold"
# "Protections","OTD","Delay"
batt_smbus -X write_flash 18822 1 2
echo "Wrote smart battery param - OTD Delay"
# "Protections","OTD","Recovery"
batt_smbus -X write_flash 18823 2 254 13
echo "Wrote smart battery param - OTD Recovery"


# "Gas Gauging","IT Cfg","Term Min Cell V"
batt_smbus -X write_flash 18511 2 -128 12
echo "Wrote smart battery param - Term Min Cell V"
# "Gas Gauging","IT Cfg","Term Voltage"
batt_smbus -X write_flash 18506 2 0 50
echo "Wrote smart battery param - Term Voltage"
# "Gas Gauging","Current Thresholds","Chg Current Threshold"
batt_smbus -X write_flash 19083 2 44 1
echo "Wrote smart battery param - Chg Current Threshold"
# "Gas Gauging","SOH","SOH Load Rate"
batt_smbus -X write_flash 18553 1 2
echo "Wrote smart battery param - SOH Load Rate"

batt_smbus -X resume